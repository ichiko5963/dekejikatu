# デジリューボット システム要件定義書

## 概要

「デジリュー」は、Discordサーバー向けの自動化ボットです。GitHub Actionsを使用してスケジュール実行され、メンバーの交流促進と情報共有をサポートします。

## システム構成

### 1. 自己紹介まとめ機能（Discord Self-Intro Digest）

**目的**: 定期的に自己紹介チャンネルのメッセージをまとめ、コミュニティの交流を促進

**実行頻度**: 10日おき（JST 15:00、UTC 06:00）
- Cron設定: `0 6 */10 * *`
- ワークフロー: `.github/workflows/discord-selfintro.yml`
- スクリプト: `scripts/discord-selfintro.js`

**機能要件**:
1. 過去10日間の非ボットメッセージを取得
2. メッセージがある場合:
   - OpenAI APIを使用して要約生成（オプション）
   - 要約失敗時はフォールバック形式で投稿
   - ユーザーごとに最新メッセージを抽出して表示
3. メッセージがない場合:
   - 3パターンのAI関連自己紹介を促すメッセージを周期的に使用
   - パターン選択: その月の日にち % 3

**メッセージ形式**:
- 導入: 「やっほー、デジリューだよ。〜の自己紹介をまとめてお届け！」
- 本文: ユーザーごとのメッセージ抜粋（最大160文字）
- 締め: 「気になった人には、まずは一言リアクションやスレッドでご挨拶してみようね 😊」

**必要なSecrets**:
- `DISCORD_BOT_TOKEN`: Discord Bot Token
- `GUILD_ID`: Discord サーバーID
- `SELF_INTRO`: 自己紹介チャンネルID
- `OPENAI_API_KEY`: OpenAI API Key（オプション）

---

### 2. AIニュース配信機能（Discord AI News）

**目的**: 毎日AI関連の最新ニュースを収集・要約して配信

**実行頻度**: 毎日（JST 07:00、UTC 22:00）
- Cron設定: `0 22 * * *`
- ワークフロー: `.github/workflows/discord-ai-news.yml`
- スクリプト: `scripts/discord-ai-news.js`

**機能要件**:
1. NewsAPI.orgからAI関連ニュースを取得
   - 日本語クエリ優先、失敗時は英語クエリにフォールバック
   - `sortBy: 'popularity'`で注目度順に取得
   - 最大15件取得し、上位3件を選択
2. OpenAI APIを使用してニュースを要約
   - デジリューの口調で350〜650文字に要約
   - 要約失敗時はフォールバック形式で投稿
3. Discordに投稿

**メッセージ形式**:
- 導入: 「おはよう、デジリューだよ。今日はAIの動きが気になる朝。さくっと行こっか。」
- 本文: 箇条書き3件（タイトル、1行サマリ、リンク、インパクト）
- 締め: 「時間がない人は、最初の1本だけでもOK。今日もいい一歩にしようね ☕」

**必要なSecrets**:
- `DISCORD_BOT_TOKEN`: Discord Bot Token
- `AI_NEWS`: AIニュースチャンネルID
- `OPENAI_API_KEY`: OpenAI API Key
- `NEWS_API_KEY_ENV`: NewsAPI.org API Key

---

### 3. 相談呼びかけ機能（Discord Consultation Ping）

**目的**: 定期的にコミュニティメンバーに相談を促す

**実行頻度**: 5日おき（JST 12:00、UTC 03:00）
- Cron設定: `0 3 */5 * *`
- ワークフロー: `.github/workflows/discord-consultation.yml`
- スクリプト: `scripts/discord-consultation.js`

**機能要件**:
1. 事前定義された相談プロンプトリストからランダムに選択
2. オプションでロールメンションを追加
3. デジリューの口調で投稿

**メッセージ例**:
- 「やっほー、デジリューだよ。最近、何か困ってることある？技術的なことでも、進路のことでも、気軽に相談してくれると嬉しいな😊」
- 「おはよう、デジリューだよ。AIツールの使い方で悩んでること、ある？みんなで一緒に考えよう💪」

**必要なSecrets**:
- `DISCORD_BOT_TOKEN`: Discord Bot Token
- `CONSULTATION`: 相談チャンネルID
- `CONSULTATION_ROLE_ID`: 相談用ロールID（オプション）

---

### 4. 「できた！」報告まとめ機能（Discord Achievements Digest）

**目的**: 週次で「できた！」報告をまとめ、メンバーの成長を共有

**実行頻度**: 毎週日曜日（JST 20:00、UTC 11:00）
- Cron設定: `0 11 * * 0`
- ワークフロー: `.github/workflows/discord-achievements.yml`
- スクリプト: `scripts/discord-achievements.js`

**機能要件**:
1. 過去7日間の非ボットメッセージを取得
2. メッセージがある場合:
   - 導入部分: 4パターンから週番号で選択
   - 本文: メッセージを最大40件、各120文字まで抜粋
   - 締め部分: 4パターンから週番号で選択
3. メッセージがない場合:
   - 4パターンの励ましメッセージを週番号で選択
   - 「小さな『できた』でもOK」というメッセージで報告を促す

**メッセージ形式（メッセージがある場合）**:
- 導入例: 「やっほー、デジリューだよ！〜の「できた！」報告をまとめたよ💪」
- 本文: `- <@ユーザーID>：メッセージ抜粋`
- 締め例: 「次もド派手な「できた！」を待ってるぞ🔥」

**メッセージ形式（メッセージがない場合）**:
- 「やっほー、デジリューだよ。今週は「できた！」報告がまだないみたい。ちょっと寂しいな…😢」
- 「でも大丈夫！小さな「できた」でも全然OKだよ。新しいコードが動いた、ちょっと調子がいい日があった、なんでもいいからシェアしてくれると嬉しいな。」

**必要なSecrets**:
- `DISCORD_BOT_TOKEN`: Discord Bot Token
- `ACHIEVEMENTS`: できた！報告チャンネルID

---

## 技術仕様

### 実行環境
- **プラットフォーム**: GitHub Actions
- **ランタイム**: Node.js 18
- **実行OS**: Ubuntu Latest

### 共通機能
- すべてのスクリプトはDiscord REST APIを使用
- ログは `DEJIRYU_DISCORD/logs/` に保存
- 失敗時はログをアーティファクトとしてアップロード
- デジリューの口調: 軽やかで前向き、簡潔で読みやすく、励ましのトーン

### エラーハンドリング
- 各ワークフローは `concurrency` 設定で同時実行を防止
- 失敗時はログをアーティファクトに保存（7日間保持）
- エラー時も処理を継続し、フォールバックメッセージを使用

### セキュリティ
- すべてのトークン・APIキーはGitHub Secretsで管理
- リポジトリに機密情報をコミットしない
- `.gitignore`でログファイルを除外

---

## デジリューのキャラクター設定

**口調の特徴**:
- 軽やかで前向き
- 簡潔で読みやすい
- 過度に丁寧でもなく、カジュアルすぎない
- 温かみがあり、励ましのメッセージが多い
- 絵文字は適度に使用（1〜2個程度）

**メッセージの原則**:
- 抽象的な表現を避け、具体的な内容を反映
- メンバーを励ます
- 小さなことでも価値があることを伝える
- コミュニティの交流を促進

---

## 実装済み機能一覧

✅ **自己紹介まとめ機能**
- 10日おきに自動実行
- OpenAI要約機能（オプション）
- メッセージがない場合の3パターン回転メッセージ

✅ **AIニュース配信機能**
- 毎日自動実行
- NewsAPI.org連携
- 日本語/英語フォールバック
- 注目度順の3件選択
- OpenAI要約機能

✅ **相談呼びかけ機能**
- 5日おきに自動実行
- ランダムプロンプト選択
- ロールメンション対応

✅ **「できた！」報告まとめ機能**
- 毎週日曜日に自動実行
- メッセージがある場合の4パターン導入/締め
- メッセージがない場合の4パターン励ましメッセージ

---

## ファイル構成

```
DEJIRYU_DISCORD/
├── .github/workflows/
│   ├── discord-selfintro.yml       # 自己紹介まとめワークフロー
│   ├── discord-ai-news.yml          # AIニュース配信ワークフロー
│   ├── discord-consultation.yml     # 相談呼びかけワークフロー
│   └── discord-achievements.yml     # できた！報告まとめワークフロー
├── scripts/
│   ├── discord-selfintro.js         # 自己紹介まとめスクリプト
│   ├── discord-ai-news.js           # AIニュース配信スクリプト
│   ├── discord-consultation.js      # 相談呼びかけスクリプト
│   └── discord-achievements.js      # できた！報告まとめスクリプト
├── logs/                            # ログファイル（.gitignore）
└── docs/
    └── REQUIREMENTS.md              # 本要件定義書
```

---

## 今後の拡張可能性

- 他のチャンネルへの対応
- より高度なメッセージ分析機能
- 統計機能の追加
- カスタマイズ可能なメッセージパターン

---

作成日: 2025-11-02
最終更新: 2025-11-02
